
\section{ Example}

\noindent In the following example, we use 4 users (i.e., Alice, Bob, Charlie, David and Elizabeth) to show the process of the ACP. We should notice that David trusts Charlie (Charlie does not trust David), Elizabeth trusts David (David does not trust Elizabeth). Users do not trust others except the about two pairs. The parameters are shown in Table 4.8.

Table 4.8: Example Parameters

\begin{tabular}{|p{1.2in}|p{2.8in}|} \hline 
Parameters & explanation \\ \hline 
\textbf{$\boldsymbol{k}$}\textit{} & 3 \\ \hline 
\textbf{$\boldsymbol{m}$} & 1 \\ \hline 
\textbf{$\boldsymbol{Seg}$}\textit{} & 2 \\ \hline 
\textbf{$\boldsymbol{G}\boldsymbol{P}$}\textit{} & 10 minutes \\ \hline 
\textbf{$\boldsymbol{AT}$}\textit{} & 80 minutes \\ \hline 
\textbf{$\boldsymbol{\tau }$} & 80 minutes (equal to \textit{AT}) \\ \hline 
\end{tabular}

We abstract the event that users encounter each other as a table, as shown in Table 4.9. The table list the time when two users encounter each other. For example, Bob and Charlie encounter each other at the third minute. After two users meet, they separate in one minute. 

\noindent Table 4.9: Example Event

\begin{tabular}{|p{0.5in}|p{0.5in}|p{0.8in}|} \hline 
User 1 & User 2 & Time (minute) \\ \hline 
Elizabeth & Bob & t${}_{1}$ \\ \hline 
Bob & Charlie & t${}_{2}$ \\ \hline 
Charlie & Elizabeth & t${}_{3}$ \\ \hline 
Elizabeth & Alice & t${}_{4}$ \\ \hline 
Bob & Charlie & t${}_{5}$ \\ \hline 
Alice & Charlie & t${}_{6}$ \\ \hline 
Charlie & David & t${}_{7}$ \\ \hline 
David & Elizabeth & t${}_{8}$ \\ \hline 
\end{tabular}

We assume that these users do not encounter any user for a long time, so that they each has 8 ($=\frac{80min}{10min}$) ACs generated by themselves. We also assume that no AC expires in our 8-minutes example. Since the parameter \textit{Seg} is equal to 2, each user has 2 \textit{Distributing AC List}s (\textit{DL}s). The initial state of our example is shown in Table 4.10. To make the example simple and clear, we do not place ACs in DLs randomly, ACs are always placed in the DL alternately. For example, if we put the first AC in DL1, then the second AC must be in the DL2. Users also obey the rule when they receive ACs from other users.

Table 4.10: Example Initial State

\begin{tabular}{|p{0.9in}|p{1.4in}|p{1.4in}|p{0.6in}|} \hline 
User Identity & DL1 & DL2 & RL \\ \hline 
Alice (A) & ${\mathrm{AC}}^{\mathrm{1}\left[0\right]}_{\mathrm{A}},{\mathrm{AC}}^{\mathrm{3}\left[0\right]}_{\mathrm{A}},{\mathrm{AC}}^{\mathrm{5}\left[0\right]}_{\mathrm{A}},{\mathrm{AC}}^{\mathrm{7}\left[0\right]}_{\mathrm{A}}$ & ${\mathrm{AC}}^{\mathrm{2}\left[0\right]}_{\mathrm{A}},{\mathrm{AC}}^{\mathrm{4}\left[0\right]}_{\mathrm{A}},{\mathrm{AC}}^{\mathrm{6}\left[0\right]}_{\mathrm{A}},{\mathrm{AC}}^{\mathrm{8}\left[0\right]}_{\mathrm{A}}$ & $\mathrm{\emptyset }$ \\ \hline 
Bob (B) & ${\mathrm{AC}}^{\mathrm{1}\left[0\right]}_{\mathrm{B}},{\mathrm{AC}}^{\mathrm{3}\left[0\right]}_{\mathrm{B}},{\mathrm{AC}}^{\mathrm{5}\left[0\right]}_{\mathrm{B}},{\mathrm{AC}}^{\mathrm{7}\left[0\right]}_{\mathrm{B}}$ & ${\mathrm{AC}}^{\mathrm{2}\left[0\right]}_{\mathrm{B}},{\mathrm{AC}}^{\mathrm{4}\left[0\right]}_{\mathrm{B}},{\mathrm{AC}}^{\mathrm{6}\left[0\right]}_{\mathrm{B}},{\mathrm{AC}}^{\mathrm{8}\left[0\right]}_{\mathrm{B}}$ & $\mathrm{\emptyset }$ \\ \hline 
Charlie (C) & ${\mathrm{AC}}^{\mathrm{1}\left[0\right]}_{\mathrm{C}},{\mathrm{AC}}^{\mathrm{3}\left[0\right]}_{\mathrm{C}},{\mathrm{AC}}^{\mathrm{5}\left[0\right]}_{\mathrm{C}},{\mathrm{AC}}^{\mathrm{7}\left[0\right]}_{\mathrm{C}}$ & ${\mathrm{AC}}^{\mathrm{2}\left[0\right]}_{\mathrm{C}},{\mathrm{AC}}^{\mathrm{4}\left[0\right]}_{\mathrm{C}},{\mathrm{AC}}^{\mathrm{6}\left[0\right]}_{\mathrm{C}},{\mathrm{AC}}^{\mathrm{8}\left[0\right]}_{\mathrm{C}}$ & $\mathrm{\emptyset }$ \\ \hline 
David (D) & ${\mathrm{AC}}^{\mathrm{1}\left[0\right]}_{\mathrm{D}},{\mathrm{AC}}^{\mathrm{3}\left[0\right]}_{\mathrm{D}},{\mathrm{AC}}^{\mathrm{5}\left[0\right]}_{\mathrm{D}},{\mathrm{AC}}^{\mathrm{7}\left[0\right]}_{\mathrm{D}}$ & ${\mathrm{AC}}^{\mathrm{2}\left[0\right]}_{\mathrm{D}},{\mathrm{AC}}^{\mathrm{4}\left[0\right]}_{\mathrm{D}},{\mathrm{AC}}^{\mathrm{6}\left[0\right]}_{\mathrm{D}},{\mathrm{AC}}^{\mathrm{8}\left[0\right]}_{\mathrm{D}}$ & $\mathrm{\emptyset }$ \\ \hline 
Elizabeth (E) & ${\mathrm{AC}}^{\mathrm{1}\left[0\right]}_{\mathrm{E}},{\mathrm{AC}}^{\mathrm{3}\left[0\right]}_{\mathrm{E}},{\mathrm{AC}}^{\mathrm{5}\left[0\right]}_{\mathrm{E}},{\mathrm{AC}}^{\mathrm{7}\left[0\right]}_{\mathrm{E}}$ & ${\mathrm{AC}}^{\mathrm{2}\left[0\right]}_{\mathrm{E}},{\mathrm{AC}}^{\mathrm{4}\left[0\right]}_{\mathrm{E}},{\mathrm{AC}}^{\mathrm{6}\left[0\right]}_{\mathrm{E}},{\mathrm{AC}}^{\mathrm{8}\left[0\right]}_{\mathrm{E}}$ & $\mathrm{\emptyset }$ \\ \hline 
\end{tabular}

The explanation of symbols used in table are shown in the former Table 4.1. To make the symbol clear, we add the EQL of the AC on its symbol. For example, if the EQL of ${AC}^1_{A,X}$ is equal to 2, it is marked as ${AC}^{1\left[2\right]}_{A,X}$.


\subsection{ Exchanging Appointment Cards}

\noindent To make it easier, users do not pick DLs randomly as we described in the previous sections when they exchange ACs. Instead, when $U_x$ encounters $U_y$, $U_x$ always picks his DL1 and $U_y$ always picks his DL2. 

\noindent The tables in current section show the entire Distributing AC Lists (i.e. DL1 and DL2) and entire relay tables (RLs) of each user. We use the initial letter to denote each user in symbols. For example, D denotes David. In the reply tables, we color old entries with darker color to high light new ones. The structure of the AC-list tables is shown in Table 4.11, where we mark the picked DL with a darker color.

Table 4.11: User X and Y's AC Lists

\begin{tabular}{|p{0.2in}|p{0.3in}|p{0.4in}|p{1.9in}|} \hline 
X & DL1 & Before & X's distributing AC list 1 before their exchange. \\ \hline 
 &  & After & X's distributing AC list 1 after their exchange. \\ \hline 
 & DL2 & Before & X's distributing AC list 2 before their exchange. \\ \hline 
 &  & After & X's distributing AC list 2 after their exchange. \\ \hline 
 & RL & Before & X's ready AC list before their exchange. \\ \hline 
 &  & After & X's ready AC list after their exchange. \\ \hline 
Y & DL1 & Before & Y's distributing AC list 1 before their exchange. \\ \hline 
 &  & After & Y's distributing AC list 1 after their exchange. \\ \hline 
 & DL2 & Before & Y's distributing AC list 2 before their exchange. \\ \hline 
 &  & After & Y's distributing AC list 2 after their exchange. \\ \hline 
 & RL & Before & Y's ready AC list before their exchange. \\ \hline 
 &  & After & Y's ready AC list after their exchange. \\ \hline 
\end{tabular}

The process of exchanging AC is shown step by step as follows.

\begin{enumerate}
\item  Elizabeth encounters Bob
\end{enumerate}

\noindent At the first minute, Elizabeth encounters Bob. Elizabeth picks her DL1, and Bob picks his DL2. They give distributing ACs in their picked DLs to each other and update their reply tables, as shown in Table 4.12 and Table 4.13.

Table 4.12: Elizabeth and Bob's AC Lists At Time 1

\begin{tabular}{|p{0.5in}|p{0.3in}|p{0.4in}|p{1.8in}|} \hline 
Elizabeth & DL1 & Before & ${AC}^{1\left[0\right]}_E,{AC}^{3\left[0\right]}_E,{AC}^{5\left[0\right]}_E,{AC}^{7\left[0\right]}_E$ \\ \hline 
 &  & After & ${AC}^{2\left[1\right]}_{B,B},{AC}^{6\left[1\right]}_{B,B}$ \\ \hline 
 & DL2 & Before & ${AC}^{2\left[0\right]}_E,{AC}^{4\left[0\right]}_E,{AC}^{6\left[0\right]}_E,{AC}^{8\left[0\right]}_E$ \\ \hline 
 &  & After & ${AC}^{2\left[0\right]}_E,{AC}^{4\left[0\right]}_E,{AC}^{6\left[0\right]}_E,{AC}^{8\left[0\right]}_E,{AC}^{4\left[1\right]}_{B,B},{AC}^{8\left[1\right]}_{B,B}$ \\ \hline 
 & RL & Before & $\mathrm{\emptyset }$ \\ \hline 
 &  & After & $\mathrm{\emptyset }$ \\ \hline 
Bob & DL1 & Before & ${AC}^{1\left[0\right]}_B,{AC}^{3\left[0\right]}_B,{AC}^{5\left[0\right]}_B,{AC}^{7\left[0\right]}_B$ \\ \hline 
 &  & After & ${AC}^{1\left[0\right]}_B,{AC}^{3\left[0\right]}_B,{AC}^{5\left[0\right]}_B,{AC}^{7\left[0\right]}_B,{AC}^{1\left[1\right]}_{E,E},{AC}^{5\left[1\right]}_{E,E}$ \\ \hline 
 & DL2 & Before & ${AC}^{2\left[0\right]}_B,{AC}^{4\left[0\right]}_B,{AC}^{6\left[0\right]}_B,{AC}^{8\left[0\right]}_B$ \\ \hline 
 &  & After & ${AC}^{3\left[1\right]}_{E,E},{AC}^{7\left[1\right]}_{E,E}$ \\ \hline 
 & RL & Before & $\mathrm{\emptyset }$ \\ \hline 
 &  & After & $\mathrm{\emptyset }$ \\ \hline 
\end{tabular}

Table 4.13: Elizabeth and Bob's Relay Table At Time t${}_{1}$

\begin{tabular}{|p{0.4in}|p{0.4in}|p{0.3in}|p{0.5in}|p{0.3in}|p{0.4in}|p{0.4in}|p{0.4in}|p{0.4in}|p{0.5in}|} \hline 
\multicolumn{5}{|p{1in}|}{Elizabeth} & \multicolumn{5}{|p{2.0in}|}{Bob} \\ \hline 
${Aid}_{old}$ & ${Aapt}_{old}$ & ${ID}_{nxt}$ & ${Aapt}_{new}$ & EQL & ${Aid}_{old}$ & ${Aapt}_{old}$ & ${ID}_{nxt}$ & ${Aapt}_{new}$ & EQL \\ \hline 
E & ${capt}^1_E$ & B & ${aapt}^{E\left(1\right)}_E$ & 1 & B & B & ${capt}^2_B$ & E & ${aapt}^{B\left(2\right)}_B$ \\ \hline 
E & ${capt}^3_E$ & B & ${aapt}^{E\left(3\right)}_E$ & 1 & B & B & ${capt}^4_B$ & E & ${aapt}^{B\left(4\right)}_B$ \\ \hline 
E & ${capt}^5_E$ & B & ${aapt}^{E\left(5\right)}_E$ & 1 & B & B & ${capt}^6_B$ & E & ${aapt}^{B\left(6\right)}_B$ \\ \hline 
E & ${capt}^7_E$ & B & ${aapt}^{E\left(7\right)}_E$ & 1 & B & B & ${capt}^8_B$ & E & ${aapt}^{B\left(8\right)}_B$ \\ \hline 
\end{tabular}

\begin{enumerate}
\item  Bob encounters Charlie
\end{enumerate}

\noindent At time t${}_{2}$, Bob encounters Charlie. Bob picks his DL1, and Charlie picks his DL2. They give distributing ACs in their picked DLs to each other and update their reply tables, as shown in Table 4.14 and Table 4.15.

\noindent 

Table 4.14: Bob and Charlie's AC Lists At Time t${}_{2}$

\begin{tabular}{|p{0.4in}|p{0.3in}|p{0.4in}|p{2.0in}|} \hline 
Bob & DL1 & Before & ${AC}^{1\left[0\right]}_B,{AC}^{3\left[0\right]}_B,{AC}^{5\left[0\right]}_B,{AC}^{7\left[0\right]}_B,{AC}^{1\left[1\right]}_{E,E},{AC}^{5\left[1\right]}_{E,E}$ \\ \hline 
 &  & After & ${AC}^{2\left[1\right]}_{C,C},{AC}^{6\left[1\right]}_{C,C}$ \\ \hline 
 & DL2 & Before & ${AC}^{3\left[1\right]}_{E,E},{AC}^{7\left[1\right]}_{E,E}$ \\ \hline 
 &  & After & ${AC}^{3\left[1\right]}_{E,E},{AC}^{7\left[1\right]}_{E,E},{AC}^{4\left[1\right]}_{C,C},{AC}^{8\left[1\right]}_{C,C}$ \\ \hline 
 & RL & Before & $\mathrm{\emptyset }$ \\ \hline 
 &  & After & $\mathrm{\emptyset }$ \\ \hline 
Charlie & DL1 & Before & ${AC}^{1\left[0\right]}_C,{AC}^{3\left[0\right]}_C,{AC}^{5\left[0\right]}_C,{AC}^{7\left[0\right]}_C$ \\ \hline 
 &  & After & ${AC}^{1\left[0\right]}_C,{AC}^{3\left[0\right]}_C,{AC}^{5\left[0\right]}_C,{AC}^{7\left[0\right]}_C,{AC}^{1\left[1\right]}_{B,B},{AC}^{5\left[1\right]}_{B,B},{AC}^{1\left[2\right]}_{E,B}$ \\ \hline 
 & DL2 & Before & ${AC}^{2\left[0\right]}_C,{AC}^{4\left[0\right]}_C,{AC}^{6\left[0\right]}_C,{AC}^{8\left[0\right]}_C$ \\ \hline 
 &  & After & ${AC}^{3\left[1\right]}_{B,B},{AC}^{7\left[1\right]}_{B,B},{AC}^{5\left[2\right]}_{E,B}$ \\ \hline 
 & RL & Before & $\mathrm{\emptyset }$ \\ \hline 
 &  & After & $\mathrm{\emptyset }$ \\ \hline 
\end{tabular}


Table 4.15: Bob and Charlie's Relay Table At Time t${}_{2}$

\begin{tabular}{|p{0.4in}|p{0.5in}|p{0.3in}|p{0.5in}|p{0.3in}|p{0.4in}|p{0.4in}|p{0.3in}|p{0.5in}|p{0.3in}|} \hline 
\multicolumn{5}{|p{1in}|}{Bob} & \multicolumn{5}{|p{1.8in}|}{Charlie} \\ \hline 
${Aid}_{old}$ & ${Aapt}_{old}$ & ${ID}_{nxt}$ & ${Aapt}_{new}$ & EQL & ${Aid}_{old}$ & ${Aapt}_{old}$ & ${ID}_{nxt}$ & ${Aapt}_{new}$ & EQL \\ \hline 
B & ${capt}^2_B$ & E & ${aapt}^{B\left(2\right)}_B$ & 1 & C & ${capt}^2_C$ & B & ${aapt}^{C\left(2\right)}_C$ & 1 \\ \hline 
B & ${capt}^4_B$ & E & ${aapt}^{B\left(4\right)}_B$ & 1 & C & ${capt}^4_C$ & B & ${aapt}^{C\left(4\right)}_C$ & 1 \\ \hline 
B & ${capt}^6_B$ & E & ${aapt}^{B\left(6\right)}_B$ & 1 & C & ${capt}^6_C$ & B & ${aapt}^{C\left(6\right)}_C$ & 1 \\ \hline 
B & ${capt}^8_B$ & E & ${aapt}^{B\left(8\right)}_B$ & 1 & C & ${capt}^8_C$ & B & ${aapt}^{C\left(8\right)}_C$ & 1 \\ \hline 
B & ${capt}^1_B$ & C & ${aapt}^{B\left(1\right)}_B$ & 1 &  &  &  &  &  \\ \hline 
B & ${capt}^3_B$ & C & ${aapt}^{B\left(3\right)}_B$ & 1 &  &  &  &  &  \\ \hline 
B & ${capt}^5_B$ & C & ${aapt}^{B\left(5\right)}_B$ & 1 &  &  &  &  &  \\ \hline 
B & ${capt}^7_B$ & C & ${aapt}^{B\left(7\right)}_B$ & 1 &  &  &  &  &  \\ \hline 
E & ${aapt}^{E\left(1\right)}_E$ & C & ${aapt}^{E\left(1\right)}_B$ & 2 &  &  &  &  &  \\ \hline 
E & ${aapt}^{E\left(5\right)}_E$ & C & ${aapt}^{E\left(5\right)}_B$ & 2 &  &  &  &  &  \\ \hline 
\end{tabular}



\noindent 

\noindent 

\begin{enumerate}
\item  Charlie encounters Elizabeth
\end{enumerate}

\noindent At time t${}_{3}$, Charlie encounters Elizabeth. Charlie picks his DL1, and Elizabeth picks her DL2. They give distributing ACs in their picked DLs to each other and update their reply tables, as shown in Table 4.16 and Table 4.17.

\noindent We should notice that Charlie does not give ${AC}^{1\left[2\right]}_{E,B}$ to Elizabeth, because Elizabeth does not trust Charlie. The EQL of the ${AC}^{1\left[2\right]}_{E,B}$ has already reached 2, which is equal to $k-m=3-1$. As mentioned in 4.6.2, these kinds of ACs are only sent to users who trust the current agent. Therefore, Charlie cannot give ${AC}^{1\left[2\right]}_{E,B}$ to Elizabeth when she does not trust him.

\noindent 

\noindent \eject 

Table 4.16: Charlie and Elizabeth's AC Lists At Time t${}_{3}$

\begin{tabular}{|p{0.5in}|p{0.3in}|p{0.4in}|p{2.0in}|} \hline 
Charlie & DL1 & Before & ${AC}^{1\left[0\right]}_C,{AC}^{3\left[0\right]}_C,{AC}^{5\left[0\right]}_C,{AC}^{7\left[0\right]}_C,{AC}^{1\left[1\right]}_{B,B},{AC}^{5\left[1\right]}_{B,B},{AC}^{1\left[2\right]}_{E,B}$ \\ \hline 
 &  & After & ${AC}^{1\left[2\right]}_{E,B},{AC}^{2\left[1\right]}_{E,E},{AC}^{6\left[1\right]}_{E,E},{AC}^{4\left[2\right]}_{B,E}$ \\ \hline 
 & DL2 & Before & ${AC}^{3\left[1\right]}_{B,B},{AC}^{7\left[1\right]}_{B,B},{AC}^{5\left[2\right]}_{E,B}$ \\ \hline 
 &  & After & ${AC}^{3\left[1\right]}_{B,B},{AC}^{7\left[1\right]}_{B,B},{AC}^{5\left[2\right]}_{E,B},{AC}^{4\left[1\right]}_{E,E},{AC}^{8\left[1\right]}_{E,E},{AC}^{8\left[2\right]}_{B,E}$ \\ \hline 
 & RL & Before & $\mathrm{\emptyset }$ \\ \hline 
 &  & After & $\mathrm{\emptyset }$ \\ \hline 
Elizabeth & DL1 & Before & ${AC}^{2\left[1\right]}_{B,B},{AC}^{6\left[1\right]}_{B,B}$ \\ \hline 
 &  & After & ${AC}^{2\left[1\right]}_{B,B},{AC}^{6\left[1\right]}_{B,B},{AC}^{1\left[1\right]}_{C,C},{AC}^{5\left[1\right]}_{C,C},{AC}^{1\left[2\right]}_{B,C}$ \\ \hline 
 & DL2 & Before & ${AC}^{2\left[0\right]}_E,{AC}^{4\left[0\right]}_E,{AC}^{6\left[0\right]}_E,{AC}^{8\left[0\right]}_E,{AC}^{4\left[1\right]}_{B,B},{AC}^{8\left[1\right]}_{B,B}$ \\ \hline 
 &  & After & ${AC}^{3\left[1\right]}_{C,C},{AC}^{7\left[1\right]}_{C,C},{AC}^{5\left[2\right]}_{B,C}$ \\ \hline 
 & RL & Before & $\mathrm{\emptyset }$ \\ \hline 
 &  & After & $\mathrm{\emptyset }$ \\ \hline 
\end{tabular}

Table 4.17: Charlie and Elizabeth's Relay Table At Time t${}_{3}$

\begin{tabular}{|p{0.4in}|p{0.5in}|p{0.3in}|p{0.5in}|p{0.3in}|p{0.4in}|p{0.5in}|p{0.3in}|p{0.5in}|p{0.3in}|} \hline 
\multicolumn{5}{|p{1in}|}{Charlie} & \multicolumn{5}{|p{1.9in}|}{Elizabeth} \\ \hline 
${Aid}_{old}$ & ${Aapt}_{old}$ & ${ID}_{nxt}$ & ${Aapt}_{new}$ & EQL & ${Aid}_{old}$ & ${Aapt}_{old}$ & ${ID}_{nxt}$ & ${Aapt}_{new}$ & EQL \\ \hline 
C & ${capt}^2_C$ & B & ${aapt}^{C\left(2\right)}_C$ & 1 & E & ${capt}^1_E$ & B & ${aapt}^{E\left(1\right)}_E$ & 1 \\ \hline 
C & ${capt}^4_C$ & B & ${aapt}^{C\left(4\right)}_C$ & 1 & E & ${capt}^3_E$ & B & ${aapt}^{E\left(3\right)}_E$ & 1 \\ \hline 
C & ${capt}^6_C$ & B & ${aapt}^{C\left(6\right)}_C$ & 1 & E & ${capt}^5_E$ & B & ${aapt}^{E\left(5\right)}_E$ & 1 \\ \hline 
C & ${capt}^8_C$ & B & ${aapt}^{C\left(8\right)}_C$ & 1 & E & ${capt}^7_E$ & B & ${aapt}^{E\left(7\right)}_E$ & 1 \\ \hline 
C & ${capt}^1_C$ & E & ${aapt}^{C\left(1\right)}_C$ & 1 & E & ${capt}^2_E$ & C & ${aapt}^{E\left(2\right)}_E$ & 1 \\ \hline 
C & ${capt}^3_C$ & E & ${aapt}^{C\left(3\right)}_C$ & 1 & E & ${capt}^4_E$ & C & ${aapt}^{E\left(4\right)}_E$ & 1 \\ \hline 
C & ${capt}^5_C$ & E & ${aapt}^{C\left(5\right)}_C$ & 1 & E & ${capt}^6_E$ & C & ${aapt}^{E\left(6\right)}_E$ & 1 \\ \hline 
C & ${capt}^7_C$ & E & ${aapt}^{C\left(7\right)}_C$ & 1 & E & ${capt}^8_E$ & C & ${aapt}^{E\left(8\right)}_E$ & 1 \\ \hline 
B & ${aapt}^{B\left(1\right)}_B$ & E & ${aapt}^{B\left(1\right)}_C$ & 2 & B & ${aapt}^{B\left(4\right)}_B$ & C & ${aapt}^{B\left(4\right)}_E$ & 2 \\ \hline 
B & ${aapt}^{B\left(5\right)}_B$ & E & ${aapt}^{B\left(5\right)}_C$ & 2 & B & ${aapt}^{B\left(8\right)}_B$ & C & ${aapt}^{B\left(8\right)}_E$ & 2 \\ \hline 
\end{tabular}

\begin{enumerate}
\item  Elizabeth encounters Alice
\end{enumerate}

\noindent At time t${}_{4}$, Elizabeth encounters Alice. Elizabeth picks her DL1, and Alice picks her DL2. They give distributing ACs in their picked DLs to each other and update their reply tables, as shown in Table 4.18 and Table 4.19.

\noindent Elizabeth does not give ${AC}^{1\left[2\right]}_{B,C}$ to Alice for the same reason as the previous Charlie, that is, Alice does not trust Elizabeth.

Table 4.18: Elizabeth and Alice's AC Lists At Time t${}_{4}$

\begin{tabular}{|p{0.5in}|p{0.3in}|p{0.4in}|p{1.8in}|} \hline 
Elizabeth & DL1 & Before & ${AC}^{2\left[1\right]}_{B,B},{AC}^{6\left[1\right]}_{B,B},{AC}^{1\left[1\right]}_{C,C},{AC}^{5\left[1\right]}_{C,C},{AC}^{1\left[2\right]}_{B,C}$ \\ \hline 
 &  & After & ${AC}^{1\left[2\right]}_{B,C},{AC}^{2\left[1\right]}_{A,A},{AC}^{6\left[1\right]}_{A,A}$ \\ \hline 
 & DL2 & Before & ${AC}^{3\left[1\right]}_{C,C},{AC}^{7\left[1\right]}_{C,C},{AC}^{5\left[2\right]}_{B,C}$ \\ \hline 
 &  & After & ${AC}^{3\left[1\right]}_{C,C},{AC}^{7\left[1\right]}_{C,C},{AC}^{5\left[2\right]}_{B,C},{AC}^{4\left[1\right]}_{A,A},{AC}^{8\left[1\right]}_{A,A}$ \\ \hline 
 & RL & Before & $\mathrm{\emptyset }$ \\ \hline 
 &  & After & $\mathrm{\emptyset }$ \\ \hline 
Alice & DL1 & Before & ${AC}^{1\left[0\right]}_A,{AC}^{3\left[0\right]}_A,{AC}^{5\left[0\right]}_A,{AC}^{7\left[0\right]}_A$ \\ \hline 
 &  & After & ${AC}^{1\left[0\right]}_A,{AC}^{3\left[0\right]}_A,{AC}^{5\left[0\right]}_A,{AC}^{7\left[0\right]}_A,{AC}^{2\left[2\right]}_{B,E},{AC}^{1\left[2\right]}_{C,E}$ \\ \hline 
 & DL2 & Before & ${AC}^{2\left[0\right]}_A,{AC}^{4\left[0\right]}_A,{AC}^{6\left[0\right]}_A,{AC}^{8\left[0\right]}_A$ \\ \hline 
 &  & After & ${AC}^{6\left[2\right]}_{B,E},{AC}^{5\left[2\right]}_{C,E}$ \\ \hline 
 & RL & Before & $\mathrm{\emptyset }$ \\ \hline 
 &  & After & $\mathrm{\emptyset }$ \\ \hline 
\end{tabular}


Table 4.19: Elizabeth and Alice's Relay Table At Time t${}_{4}$

\begin{tabular}{|p{0.4in}|p{0.5in}|p{0.3in}|p{0.5in}|p{0.3in}|p{0.4in}|p{0.4in}|p{0.3in}|p{0.5in}|p{0.3in}|} \hline 
\multicolumn{5}{|p{1in}|}{Elizabeth} & \multicolumn{5}{|p{1.8in}|}{Alice} \\ \hline 
${Aid}_{old}$ & ${Aapt}_{old}$ & ${ID}_{nxt}$ & ${Aapt}_{new}$ & EQL & ${Aid}_{old}$ & ${Aapt}_{old}$ & ${ID}_{nxt}$ & ${Aapt}_{new}$ & EQL \\ \hline 
E & ${capt}^1_E$ & B & ${aapt}^{E\left(1\right)}_E$ & 1 & A & ${capt}^2_A$ & E & ${aapt}^{A\left(2\right)}_A$ & 1 \\ \hline 
E & ${capt}^3_E$ & B & ${aapt}^{E\left(3\right)}_E$ & 1 & A & ${capt}^4_A$ & E & ${aapt}^{A\left(4\right)}_A$ & 1 \\ \hline 
E & ${capt}^5_E$ & B & ${aapt}^{E\left(5\right)}_E$ & 1 & A & ${capt}^6_A$ & E & ${aapt}^{A\left(6\right)}_A$ & 1 \\ \hline 
E & ${capt}^7_E$ & B & ${aapt}^{E\left(7\right)}_E$ & 1 & A & ${capt}^8_A$ & E & ${aapt}^{A\left(8\right)}_A$ & 1 \\ \hline 
E & ${capt}^2_E$ & C & ${aapt}^{E\left(2\right)}_E$ & 1 &  &  &  &  &  \\ \hline 
E & ${capt}^4_E$ & C & ${aapt}^{E\left(4\right)}_E$ & 1 &  &  &  &  &  \\ \hline 
E & ${capt}^6_E$ & C & ${aapt}^{E\left(6\right)}_E$ & 1 &  &  &  &  &  \\ \hline 
E & ${capt}^8_E$ & C & ${aapt}^{E\left(8\right)}_E$ & 1 &  &  &  &  &  \\ \hline 
B & ${aapt}^{B\left(4\right)}_B$ & C & ${aapt}^{B\left(4\right)}_E$ & 2 &  &  &  &  &  \\ \hline 
B & ${aapt}^{B\left(8\right)}_B$ & C & ${aapt}^{B\left(8\right)}_E$ & 2 &  &  &  &  &  \\ \hline 
B & ${aapt}^{B\left(2\right)}_B$ & A & ${aapt}^{B\left(2\right)}_E$ & 2 &  &  &  &  &  \\ \hline 
B & ${aapt}^{B\left(6\right)}_B$ & A & ${aapt}^{B\left(6\right)}_E$ & 2 &  &  &  &  &  \\ \hline 
C & ${aapt}^{C\left(1\right)}_C$ & A & ${aapt}^{C\left(1\right)}_E$ & 2 &  &  &  &  &  \\ \hline 
C & ${aapt}^{C\left(5\right)}_C$ & A & ${aapt}^{C\left(5\right)}_E$ & 2 &  &  &  &  &  \\ \hline 
\end{tabular}

\begin{enumerate}
\item  Bob encounters Charlie
\end{enumerate}

\noindent At time t${}_{5}$, Bob encounters Charlie. Bob picks his DL1, and Charlie picks his DL2. They give distributing ACs in their picked DLs to each other and update their reply tables, as shown in Table 4.20 and Table 4.21.

\noindent Charlie does not give ${AC}^{5\left[2\right]}_{E,B}$ and $\ {AC}^{8\left[2\right]}_{B,E}$ to Bob, because Bob does not trust Charlie. Since we set the avoiding time equal to \textit{AT}, a distributing AC cannot be given back to previous agents. As a result, ${AC}^{2\left[1\right]}_{C,C}$, ${AC}^{6\left[1\right]}_{C,C}$, ${AC}^{3\left[1\right]}_{B,B}$ and ${AC}^{7\left[1\right]}_{B,B}$ are not exchanged by Charlie and Bob.

\noindent 

Table 4.20: Bob and Charlie's AC Lists At Time t${}_{5}$

\begin{tabular}{|p{0.4in}|p{0.3in}|p{0.4in}|p{1.6in}|} \hline 
Bob & DL1 & Before & ${AC}^{2\left[1\right]}_{C,C},{AC}^{6\left[1\right]}_{C,C}$ \\ \hline 
 &  & After & ${AC}^{2\left[1\right]}_{C,C},{AC}^{6\left[1\right]}_{C,C},{AC}^{4\left[2\right]}_{E,C}$ \\ \hline 
 & DL2 & Before & ${AC}^{3\left[1\right]}_{E,E},{AC}^{7\left[1\right]}_{E,E},{AC}^{4\left[1\right]}_{C,C},{AC}^{8\left[1\right]}_{C,C}$ \\ \hline 
 &  & After & ${AC}^{3\left[1\right]}_{E,E},{AC}^{7\left[1\right]}_{E,E},{AC}^{4\left[1\right]}_{C,C},{AC}^{8\left[1\right]}_{C,C},{AC}^{8\left[2\right]}_{E,C}$ \\ \hline 
 & RL & Before & $\mathrm{\emptyset }$ \\ \hline 
 &  & After & $\mathrm{\emptyset }$ \\ \hline 
Charlie & DL1 & Before & ${AC}^{1\left[2\right]}_{E,B},{AC}^{2\left[1\right]}_{E,E},{AC}^{6\left[1\right]}_{E,E},{AC}^{4\left[2\right]}_{B,E}$ \\ \hline 
 &  & After & ${AC}^{1\left[2\right]}_{E,B},{AC}^{2\left[1\right]}_{E,E},{AC}^{6\left[1\right]}_{E,E},{AC}^{4\left[2\right]}_{B,E}$ \\ \hline 
 & DL2 & Before & ${\mathrm{AC}}^{\mathrm{3}\left[\mathrm{1}\right]}_{\mathrm{B,B}},{\mathrm{AC}}^{\mathrm{7}\left[\mathrm{1}\right]}_{\mathrm{B,B}},{\mathrm{AC}}^{\mathrm{5}\left[\mathrm{2}\right]}_{\mathrm{E,B}},{\mathrm{AC}}^{\mathrm{4}\left[\mathrm{1}\right]}_{\mathrm{E,E}},{\mathrm{AC}}^{\mathrm{8}\left[\mathrm{1}\right]}_{\mathrm{E,E}},{\mathrm{AC}}^{\mathrm{8}\left[\mathrm{2}\right]}_{\mathrm{B,E}}$ \\ \hline 
 &  & After & ${AC}^{3\left[1\right]}_{B,B},{AC}^{7\left[1\right]}_{B,B},{AC}^{5\left[2\right]}_{E,B},{AC}^{8\left[2\right]}_{B,E}$ \\ \hline 
 & RL & Before & $\mathrm{\emptyset }$ \\ \hline 
 &  & After & $\mathrm{\emptyset }$ \\ \hline 
\end{tabular}



\noindent 

\noindent 

\noindent 

\noindent Table 4.21: Bob and Charlie's Relay Table At Time t${}_{5}$

\begin{tabular}{|p{0.4in}|p{0.5in}|p{0.3in}|p{0.5in}|p{0.3in}|p{0.4in}|p{0.5in}|p{0.3in}|p{0.5in}|p{0.3in}|} \hline 
\multicolumn{5}{|p{1in}|}{Bob} & \multicolumn{5}{|p{1.9in}|}{Charlie} \\ \hline 
${Aid}_{old}$ & ${Aapt}_{old}$ & ${ID}_{nxt}$ & ${Aapt}_{old}$ & EQL & ${Aid}_{old}$ & ${Aapt}_{old}$ & ${ID}_{nxt}$ & ${Aapt}_{old}$ & EQL \\ \hline 
B & ${capt}^2_B$ & E & ${aapt}^{B\left(2\right)}_B$ & 1 & C & ${capt}^2_C$ & B & ${aapt}^{C\left(2\right)}_C$ & 1 \\ \hline 
B & ${capt}^4_B$ & E & ${aapt}^{B\left(4\right)}_B$ & 1 & C & ${capt}^4_C$ & B & ${aapt}^{C\left(4\right)}_C$ & 1 \\ \hline 
B & ${capt}^6_B$ & E & ${aapt}^{B\left(6\right)}_B$ & 1 & C & ${capt}^6_C$ & B & ${aapt}^{C\left(6\right)}_C$ & 1 \\ \hline 
B & ${capt}^8_B$ & E & ${aapt}^{B\left(8\right)}_B$ & 1 & C & ${capt}^8_C$ & B & ${aapt}^{C\left(8\right)}_C$ & 1 \\ \hline 
B & ${capt}^1_B$ & C & ${aapt}^{B\left(1\right)}_B$ & 1 & C & ${capt}^1_C$ & E & ${aapt}^{C\left(1\right)}_C$ & 1 \\ \hline 
B & ${capt}^3_B$ & C & ${aapt}^{B\left(3\right)}_B$ & 1 & C & ${capt}^3_C$ & E & ${aapt}^{C\left(3\right)}_C$ & 1 \\ \hline 
B & ${capt}^5_B$ & C & ${aapt}^{B\left(5\right)}_B$ & 1 & C & ${capt}^5_C$ & E & ${aapt}^{C\left(5\right)}_C$ & 1 \\ \hline 
B & ${capt}^7_B$ & C & ${aapt}^{B\left(7\right)}_B$ & 1 & C & ${capt}^7_C$ & E & ${aapt}^{C\left(7\right)}_C$ & 1 \\ \hline 
E & ${aapt}^{E\left(1\right)}_E$ & C & ${aapt}^{E\left(1\right)}_B$ & 2 & B & ${aapt}^{B\left(1\right)}_B$ & E & ${aapt}^{B\left(1\right)}_C$ & 2 \\ \hline 
E & ${aapt}^{E\left(5\right)}_E$ & C & ${aapt}^{E\left(5\right)}_B$ & 2 & B & ${aapt}^{B\left(5\right)}_B$ & E & ${aapt}^{B\left(5\right)}_C$ & 2 \\ \hline 
 &  &  &  &  & E & ${aapt}^{E\left(4\right)}_E$ & B & ${aapt}^{E\left(4\right)}_C$ & 2 \\ \hline 
 &  &  &  &  & E & ${aapt}^{E\left(8\right)}_E$ & B & ${aapt}^{E\left(8\right)}_C$ & 2 \\ \hline 
\end{tabular}



\noindent 

\noindent 

\begin{enumerate}
\item  Alice encounters Charlie
\end{enumerate}

\noindent At time t${}_{6}$, Alice encounters Charlie. Alice picks her DL1, and Charlie picks his DL2. They give distributing ACs in their picked DLs to each other and update their reply tables, as shown in Table 4.22 and Table 4.23.

\noindent 

\noindent 

\noindent 

\noindent 

\noindent 

\noindent 

Table 4.22: Alice and Charlie's AC Lists At Time t${}_{6}$

\begin{tabular}{|p{0.4in}|p{0.3in}|p{0.4in}|p{1.8in}|} \hline 
Bob & DL1 & Before & ${AC}^{1\left[0\right]}_A,{AC}^{3\left[0\right]}_A,{AC}^{5\left[0\right]}_A,{AC}^{7\left[0\right]}_A,{AC}^{2\left[2\right]}_{B,E},{AC}^{1\left[2\right]}_{C,E}$ \\ \hline 
 &  & After & ${AC}^{2\left[2\right]}_{B,E},{AC}^{1\left[2\right]}_{C,E},{AC}^{3\left[2\right]}_{B,C}$ \\ \hline 
 & DL2 & Before & ${AC}^{6\left[2\right]}_{B,E},{AC}^{5\left[2\right]}_{C,E}$ \\ \hline 
 &  & After & ${AC}^{6\left[2\right]}_{B,E},{AC}^{5\left[2\right]}_{C,E},{AC}^{7\left[2\right]}_{B,C}$ \\ \hline 
 & RL & Before & $\mathrm{\emptyset }$ \\ \hline 
 &  & After & $\mathrm{\emptyset }$ \\ \hline 
Charlie & DL1 & Before & ${AC}^{1\left[2\right]}_{E,B},{AC}^{2\left[1\right]}_{E,E},{AC}^{6\left[1\right]}_{E,E},{AC}^{4\left[2\right]}_{B,E}$ \\ \hline 
 &  & After & ${AC}^{1\left[2\right]}_{E,B},{AC}^{2\left[1\right]}_{E,E},{AC}^{6\left[1\right]}_{E,E},{AC}^{4\left[2\right]}_{B,E},{AC}^{1\left[1\right]}_{A,A},{AC}^{5\left[1\right]}_{A,A}$ \\ \hline 
 & DL2 & Before & ${AC}^{3\left[1\right]}_{B,B},{AC}^{7\left[1\right]}_{B,B},{AC}^{5\left[2\right]}_{E,B},{AC}^{8\left[2\right]}_{B,E}$ \\ \hline 
 &  & After & ${AC}^{5\left[2\right]}_{E,B},{AC}^{8\left[2\right]}_{B,E},{AC}^{3\left[1\right]}_{A,A},{AC}^{7\left[1\right]}_{A,A}$ \\ \hline 
 & RL & Before & $\mathrm{\emptyset }$ \\ \hline 
 &  & After & $\mathrm{\emptyset }$ \\ \hline 
\end{tabular}

Table 4.23: Alice and Charlie's Relay Table At Time t${}_{6}$

\begin{tabular}{|p{0.4in}|p{0.4in}|p{0.3in}|p{0.5in}|p{0.3in}|p{0.4in}|p{0.5in}|p{0.3in}|p{0.5in}|p{0.3in}|} \hline 
\multicolumn{5}{|p{1in}|}{Alice} & \multicolumn{5}{|p{1.9in}|}{Charlie} \\ \hline 
${Aid}_{old}$ & ${Aapt}_{old}$ & ${ID}_{nxt}$ & ${Aapt}_{new}$ & EQL & ${Aid}_{old}$ & ${Aapt}_{old}$ & ${ID}_{nxt}$ & ${Aapt}_{new}$ & EQL \\ \hline 
A & ${capt}^2_A$ & E & ${aapt}^{A\left(2\right)}_A$ & 1 & C & ${capt}^2_C$ & B & ${aapt}^{C\left(2\right)}_C$ & 1 \\ \hline 
A & ${capt}^4_A$ & E & ${aapt}^{A\left(4\right)}_A$ & 1 & C & ${capt}^4_C$ & B & ${aapt}^{C\left(4\right)}_C$ & 1 \\ \hline 
A & ${capt}^6_A$ & E & ${aapt}^{A\left(6\right)}_A$ & 1 & C & ${capt}^6_C$ & B & ${aapt}^{C\left(6\right)}_C$ & 1 \\ \hline 
A & ${capt}^8_A$ & E & ${aapt}^{A\left(8\right)}_A$ & 1 & C & ${capt}^8_C$ & B & ${aapt}^{C\left(8\right)}_C$ & 1 \\ \hline 
A & ${capt}^1_A$ & C & ${aapt}^{A\left(1\right)}_A$ & 1 & C & ${capt}^1_C$ & E & ${aapt}^{C\left(1\right)}_C$ & 1 \\ \hline 
A & ${capt}^3_A$ & C & ${aapt}^{A\left(3\right)}_A$ & 1 & C & ${capt}^3_C$ & E & ${aapt}^{C\left(3\right)}_C$ & 1 \\ \hline 
A & ${capt}^5_A$ & C & ${aapt}^{A\left(5\right)}_A$ & 1 & C & ${capt}^5_C$ & E & ${aapt}^{C\left(5\right)}_C$ & 1 \\ \hline 
A & ${capt}^7_A$ & C & ${aapt}^{A\left(7\right)}_A$ & 1 & C & ${capt}^7_C$ & E & ${aapt}^{C\left(7\right)}_C$ & 1 \\ \hline 
 &  &  &  &  & B & ${aapt}^{B\left(1\right)}_B$ & E & ${aapt}^{B\left(1\right)}_C$ & 2 \\ \hline 
 &  &  &  &  & B & ${aapt}^{B\left(5\right)}_B$ & E & ${aapt}^{B\left(5\right)}_C$ & 2 \\ \hline 
 &  &  &  &  & E & ${aapt}^{E\left(4\right)}_E$ & B & ${aapt}^{E\left(4\right)}_C$ & 2 \\ \hline 
 &  &  &  &  & E & ${aapt}^{E\left(8\right)}_E$ & B & ${aapt}^{E\left(8\right)}_C$ & 2 \\ \hline 
 &  &  &  &  & B & ${aapt}^{B\left(3\right)}_B$ & A & ${aapt}^{B\left(3\right)}_C$ & 2 \\ \hline 
 &  &  &  &  & B & ${aapt}^{B\left(7\right)}_B$ & A & ${aapt}^{B\left(7\right)}_C$ & 2 \\ \hline 
\end{tabular}

Since Alice and Charlie do not trust each other, ${AC}^{2\left[2\right]}_{B,E}$, ${AC}^{1\left[2\right]}_{C,E}$, ${AC}^{5\left[2\right]}_{E,B}$ and ${AC}^{8\left[2\right]}_{B,E}$ are not exchanged by the two users.

\begin{enumerate}
\item  Charlie encounters David
\end{enumerate}

\noindent At time t${}_{7}$, Charlie encounters David. Charlie pick his DL1, and David picks his DL2. They give distributing ACs in their picked DLs to each other and update their reply tables, as shown in Table 4.24 and Table 4.25.

\noindent Because David trust Charlie, Charlie can give ${AC}^{1\left[2\right]}_{E,B}$ and ${AC}^{4\left[2\right]}_{B,E}$ to David. When David receives ${AC}^{1\left[3\right]}_{E,C}$ and ${AC}^{4\left[3\right]}_{B,C}$, he notices that the EQLs of the two ACs reach $\mathrm{k}$ so that he puts these two ACs in his ready list instead of distributing lists.

\noindent 

\noindent 

Table 4.24: Charlie and David's AC Lists At Time t${}_{7}$

\begin{tabular}{|p{0.4in}|p{0.3in}|p{0.4in}|p{1.8in}|} \hline 
Charlie & DL1 & Before & ${AC}^{1\left[2\right]}_{E,B},{AC}^{2\left[1\right]}_{E,E},{AC}^{6\left[1\right]}_{E,E},{AC}^{4\left[2\right]}_{B,E},{AC}^{1\left[1\right]}_{A,A},{AC}^{5\left[1\right]}_{A,A}$ \\ \hline 
 &  & After & ${AC}^{2\left[1\right]}_{D,D},{AC}^{6\left[1\right]}_{D,D}$ \\ \hline 
 & DL2 & Before & ${AC}^{5\left[2\right]}_{E,B},{AC}^{8\left[2\right]}_{B,E},{AC}^{3\left[1\right]}_{A,A},{AC}^{7\left[1\right]}_{A,A}$ \\ \hline 
 &  & After & ${AC}^{5\left[2\right]}_{E,B},{AC}^{8\left[2\right]}_{B,E},{AC}^{3\left[1\right]}_{A,A},{AC}^{7\left[1\right]}_{A,A},{AC}^{4\left[1\right]}_{D,D},{AC}^{8\left[1\right]}_{D,D}$ \\ \hline 
 & RL & Before & $\mathrm{\emptyset }$ \\ \hline 
 &  & After & $\mathrm{\emptyset }$ \\ \hline 
David & DL1 & Before & ${AC}^{1\left[0\right]}_D,{AC}^{3\left[0\right]}_D,{AC}^{5\left[0\right]}_D,{AC}^{7\left[0\right]}_D$ \\ \hline 
 &  & After & ${AC}^{1\left[0\right]}_D,{AC}^{3\left[0\right]}_D,{AC}^{5\left[0\right]}_D,{AC}^{7\left[0\right]}_D,{AC}^{2\left[2\right]}_{E,C},{AC}^{1\left[2\right]}_{A,C}$ \\ \hline 
 & DL2 & Before & ${AC}^{2\left[0\right]}_D,{AC}^{4\left[0\right]}_D,{AC}^{6\left[0\right]}_D,{AC}^{8\left[0\right]}_D$ \\ \hline 
 &  & After & ${AC}^{6\left[2\right]}_{E,C},{AC}^{5\left[2\right]}_{A,C}$ \\ \hline 
 & RL & Before & $\mathrm{\emptyset }$ \\ \hline 
 &  & After & ${\mathrm{AC}}^{\mathrm{1}\left[\mathrm{3}\right]}_{\mathrm{E,C}},{\mathrm{AC}}^{\mathrm{4}\left[\mathrm{3}\right]}_{\mathrm{B,C}}$ \\ \hline 
\end{tabular}



\noindent 

\noindent 

Table 4.25: Charlie and David's Relay Table At Time t${}_{7}$

\begin{tabular}{|p{0.4in}|p{0.5in}|p{0.3in}|p{0.5in}|p{0.3in}|p{0.4in}|p{0.4in}|p{0.3in}|p{0.5in}|p{0.3in}|} \hline 
\multicolumn{5}{|p{1in}|}{Charlie} & \multicolumn{5}{|p{1.8in}|}{David} \\ \hline 
${Aid}_{old}$ & ${Aapt}_{old}$ & ${ID}_{nxt}$ & ${Aapt}_{new}$ & EQL & ${Aid}_{old}$ & ${Aapt}_{old}$ & ${ID}_{nxt}$ & ${Aapt}_{new}$ & EQL \\ \hline 
C & ${capt}^2_C$ & B & ${aapt}^{C\left(2\right)}_C$ & 1 & D & ${capt}^2_D$ & C & ${aapt}^{D\left(2\right)}_D$ & 1 \\ \hline 
C & ${capt}^4_C$ & B & ${aapt}^{C\left(4\right)}_C$ & 1 & D & ${capt}^4_D$ & C & ${aapt}^{D\left(4\right)}_D$ & 1 \\ \hline 
C & ${capt}^6_C$ & B & ${aapt}^{C\left(6\right)}_C$ & 1 & D & ${capt}^6_D$ & C & ${aapt}^{D\left(6\right)}_D$ & 1 \\ \hline 
C & ${capt}^8_C$ & B & ${aapt}^{C\left(8\right)}_C$ & 1 & D & ${capt}^8_D$ & C & ${aapt}^{D\left(8\right)}_D$ & 1 \\ \hline 
C & ${capt}^1_C$ & E & ${aapt}^{C\left(1\right)}_C$ & 1 &  &  &  &  &  \\ \hline 
C & ${capt}^3_C$ & E & ${aapt}^{C\left(3\right)}_C$ & 1 &  &  &  &  &  \\ \hline 
C & ${capt}^5_C$ & E & ${aapt}^{C\left(5\right)}_C$ & 1 &  &  &  &  &  \\ \hline 
C & ${capt}^7_C$ & E & ${aapt}^{C\left(7\right)}_C$ & 1 &  &  &  &  &  \\ \hline 
B & ${aapt}^{B\left(1\right)}_B$ & E & ${aapt}^{B\left(1\right)}_C$ & 2 &  &  &  &  &  \\ \hline 
B & ${aapt}^{B\left(5\right)}_B$ & E & ${aapt}^{B\left(5\right)}_C$ & 2 &  &  &  &  &  \\ \hline 
E & ${aapt}^{E\left(4\right)}_E$ & B & ${aapt}^{E\left(4\right)}_C$ & 2 &  &  &  &  &  \\ \hline 
E & ${aapt}^{E\left(8\right)}_E$ & B & ${aapt}^{E\left(8\right)}_C$ & 2 &  &  &  &  &  \\ \hline 
B & ${aapt}^{B\left(3\right)}_B$ & A & ${aapt}^{B\left(3\right)}_C$ & 2 &  &  &  &  &  \\ \hline 
B & ${aapt}^{B\left(7\right)}_B$ & A & ${aapt}^{B\left(7\right)}_C$ & 2 &  &  &  &  &  \\ \hline 
B & ${aapt}^{E\left(1\right)}_B$ & VOID & ${aapt}^{E\left(1\right)}_C$ & 3 &  &  &  &  &  \\ \hline 
E & ${aapt}^{E\left(2\right)}_E$ & D & ${aapt}^{E\left(2\right)}_C$ & 2 &  &  &  &  &  \\ \hline 
E & ${aapt}^{E\left(6\right)}_E$ & D & ${aapt}^{E\left(6\right)}_C$ & 2 &  &  &  &  &  \\ \hline 
E & ${aapt}^{B\left(4\right)}_E$ & VOID & ${aapt}^{B\left(4\right)}_C$ & 3 &  &  &  &  &  \\ \hline 
A & ${aapt}^{A\left(1\right)}_A$ & D & ${aapt}^{A\left(1\right)}_C$ & 2 &  &  &  &  &  \\ \hline 
A & ${aapt}^{A\left(5\right)}_A$ & D & ${aapt}^{A\left(5\right)}_C$ & 2 &  &  &  &  &  \\ \hline 
\end{tabular}



\begin{enumerate}
\item  David encounters Elizabeth
\end{enumerate}

\noindent At time t${}_{8}$, David encounters Elizabeth. David picks his DL1, and Elizabeth picks her DL2. They give distributing ACs in their picked DLs to each other and update their reply tables, as shown in Table 4.26 and Table 4.27.

\noindent After David gives Elizabeth the distributing ACs, Elizabeth gets a ready AC ${AC}^{1\left[3\right]}_{A,D}$. Then Elizabeth has 1 ready AC, while David has 2 ready ACs, so that David has only one more ready ACs than Elizabeth. That is the reason why David does not give his own ready ACs to Elizabeth, even though Elizabeth trusts David. 

\noindent We assume that Elizabeth does not get ${AC}^{1\left[3\right]}_{A,D}$, so that she has no ready AC. Then David should give her a ready AC from his own two randomly.

Table 4.26: David and Elizabeth's AC Lists At Time t${}_{8}$

\begin{tabular}{|p{0.5in}|p{0.3in}|p{0.4in}|p{1.8in}|} \hline 
David & DL1 & Before & ${AC}^{1\left[0\right]}_D,{AC}^{3\left[0\right]}_D,{AC}^{5\left[0\right]}_D,{AC}^{7\left[0\right]}_D,{AC}^{2\left[2\right]}_{E,C},{AC}^{1\left[2\right]}_{A,C}$ \\ \hline 
 &  & After & ${AC}^{2\left[2\right]}_{E,C},{AC}^{3\left[2\right]}_{C,E},{AC}^{4\left[2\right]}_{A,E}$ \\ \hline 
 & DL2 & Before & ${AC}^{6\left[2\right]}_{E,C},{AC}^{5\left[2\right]}_{A,C}$ \\ \hline 
 &  & After & ${AC}^{6\left[2\right]}_{E,C},{AC}^{5\left[2\right]}_{A,C},{AC}^{7\left[2\right]}_{C,E},{AC}^{8\left[2\right]}_{A,E}$ \\ \hline 
 & RL & Before & ${\mathrm{AC}}^{\mathrm{1}\left[\mathrm{3}\right]}_{\mathrm{E,C}},{\mathrm{AC}}^{\mathrm{4}\left[\mathrm{3}\right]}_{\mathrm{B,C}}$ \\ \hline 
 &  & After & ${\mathrm{AC}}^{\mathrm{1}\left[\mathrm{3}\right]}_{\mathrm{E,C}},{\mathrm{AC}}^{\mathrm{4}\left[\mathrm{3}\right]}_{\mathrm{B,C}}$ \\ \hline 
Elizabeth & DL1 & Before & ${AC}^{1\left[2\right]}_{B,C},{AC}^{2\left[1\right]}_{A,A},{AC}^{6\left[1\right]}_{A,A}$ \\ \hline 
 &  & After & ${AC}^{1\left[2\right]}_{B,C},{AC}^{2\left[1\right]}_{A,A},{AC}^{6\left[1\right]}_{A,A},{AC}^{1\left[1\right]}_{D,D},{AC}^{5\left[1\right]}_{D,D}$ \\ \hline 
 & DL2 & Before & ${AC}^{3\left[1\right]}_{C,C},{AC}^{7\left[1\right]}_{C,C},{AC}^{5\left[2\right]}_{B,C},{AC}^{4\left[1\right]}_{A,A},{AC}^{8\left[1\right]}_{A,A}$ \\ \hline 
 &  & After & ${AC}^{5\left[2\right]}_{B,C},{AC}^{3\left[1\right]}_{D,D},{AC}^{7\left[1\right]}_{D,D}$ \\ \hline 
 & RL & Before & $\mathrm{\emptyset }$ \\ \hline 
 &  & After & ${\mathrm{AC}}^{\mathrm{1}\left[\mathrm{3}\right]}_{\mathrm{A,D}}$ \\ \hline 
\end{tabular}


Table 4.27: David and Elizabeth's Relay Table At Time t${}_{8}$

\begin{tabular}{|p{0.4in}|p{0.5in}|p{0.3in}|p{0.5in}|p{0.3in}|p{0.4in}|p{0.5in}|p{0.3in}|p{0.5in}|p{0.3in}|} \hline 
\multicolumn{5}{|p{1in}|}{David} & \multicolumn{5}{|p{1.9in}|}{Elizabeth} \\ \hline 
${Aid}_{old}$ & ${Aapt}_{old}$ & ${ID}_{nxt}$ & ${Aapt}_{new}$ & EQL & ${Aid}_{old}$ & ${Aapt}_{old}$ & ${ID}_{nxt}$ & ${Aapt}_{new}$ & EQL \\ \hline 
D & ${capt}^2_D$ & C & ${aapt}^{D\left(2\right)}_D$ & 1 & E & ${capt}^1_E$ & B & ${aapt}^{E\left(1\right)}_E$ & 1 \\ \hline 
D & ${capt}^4_D$ & C & ${aapt}^{D\left(4\right)}_D$ & 1 & E & ${capt}^3_E$ & B & ${aapt}^{E\left(3\right)}_E$ & 1 \\ \hline 
D & ${capt}^6_D$ & C & ${aapt}^{D\left(6\right)}_D$ & 1 & E & ${capt}^5_E$ & B & ${aapt}^{E\left(5\right)}_E$ & 1 \\ \hline 
D & ${capt}^8_D$ & C & ${aapt}^{D\left(8\right)}_D$ & 1 & E & ${capt}^7_E$ & B & ${aapt}^{E\left(7\right)}_E$ & 1 \\ \hline 
D & ${capt}^1_D$ & E & ${aapt}^{D\left(1\right)}_D$ & 1 & E & ${capt}^2_E$ & C & ${aapt}^{E\left(2\right)}_E$ & 1 \\ \hline 
D & ${capt}^3_D$ & E & ${aapt}^{D\left(3\right)}_D$ & 1 & E & ${capt}^4_E$ & C & ${aapt}^{E\left(4\right)}_E$ & 1 \\ \hline 
D & ${capt}^5_D$ & E & ${aapt}^{D\left(5\right)}_D$ & 1 & E & ${capt}^6_E$ & C & ${aapt}^{E\left(6\right)}_E$ & 1 \\ \hline 
D & ${capt}^7_D$ & E & ${aapt}^{D\left(7\right)}_D$ & 1 & E & ${capt}^8_E$ & C & ${aapt}^{E\left(8\right)}_E$ & 1 \\ \hline 
C & ${aapt}^{A\left(1\right)}_C$ & VOID & ${aapt}^{A\left(1\right)}_D$ & 3 & B & ${aapt}^{B\left(4\right)}_B$ & C & ${aapt}^{B\left(4\right)}_E$ & 2 \\ \hline 
 &  &  &  &  & B & ${aapt}^{B\left(8\right)}_B$ & C & ${aapt}^{B\left(8\right)}_E$ & 2 \\ \hline 
 &  &  &  &  & B & ${aapt}^{B\left(2\right)}_B$ & A & ${aapt}^{B\left(2\right)}_E$ & 2 \\ \hline 
 &  &  &  &  & B & ${aapt}^{B\left(6\right)}_B$ & A & ${aapt}^{B\left(6\right)}_E$ & 2 \\ \hline 
 &  &  &  &  & C & ${aapt}^{C\left(1\right)}_C$ & A & ${aapt}^{C\left(1\right)}_E$ & 2 \\ \hline 
 &  &  &  &  & C & ${aapt}^{C\left(5\right)}_C$ & A & ${aapt}^{C\left(5\right)}_E$ & 2 \\ \hline 
 &  &  &  &  & C & ${aapt}^{C\left(3\right)}_C$ & D & ${aapt}^{C\left(3\right)}_E$ & 2 \\ \hline 
 &  &  &  &  & C & ${aapt}^{C\left(7\right)}_C$ & D & ${aapt}^{C\left(7\right)}_E$ & 2 \\ \hline 
 &  &  &  &  & A & ${aapt}^{A\left(4\right)}_A$ & D & ${aapt}^{A\left(4\right)}_E$ & 2 \\ \hline 
 &  &  &  &  & A & ${aapt}^{A\left(8\right)}_A$ & D & ${aapt}^{A\left(8\right)}_E$ & 2 \\ \hline 
\end{tabular}


\subsection{ Queries and Replies}

\noindent We still use the previous example and assume that the delivery of queries and replies cost little time so that no AC expires in the period.

\noindent We assume that David wants to send a query to the LBS. He chooses a AC (e.g. ${AC}^{1\left[3\right]}_{E,C}$) from his two ACs (i.e. ${AC}^{1\left[3\right]}_{E,C}$ and ${AC}^{4\left[3\right]}_{B,C}$) randomly. If we review the previous tables, we learn that ${AC}^{1\left[3\right]}_{E,C}$ is generated by Elizabeth and has 3 agents (i.e., Elizabeth, Bob and Charlie). When David uses the AC to send his query, the sender identity of the query is Elizabeth. The creator appointment number (i.e. ${capt}^1_E$) is also included in the query. Then David uses the identity of the last agent (i.e. Charlie) and the agent appointment number (i.e. ${aapt}^{E\left(1\right)}_C$) to generate a pseudonym ${psd}^{E\left(1\right)}_c=\mathrm{pseudo}\left(Charlie,{aapt}^{\mathrm{E}\left(1\right)}_c\right)$, which is used as a temporary identity of David before he receives the reply. Besides, ${AC}^{1\left[3\right]}_{E,C}$ cannot be given to any user until it expires. The process is shown in Figure 4.10.

Figure 4.10: David's Query

\noindent The LBS sends a reply message to Elizabeth based on the sender identity of the query. The creator appointment number (i.e. ${capt}^1_E$) is also included in the reply. If an attacker learns these messages, he believes that it is Elizabeth who sends the query.

\noindent When Elizabeth receives the reply message, she searches her reply table for the AC used in the reply message, as shown in Table 4.27. Since the message is sent by the LBS, the ${Aid}_{old}$ should equal to her own identity, and the ${Aapt}_{old}$ should equal to the creator appointment number. Then she must find an entry like Table 4.28, which enables Elizabeth to modify the reply message and forward to Bob, as shown in Figure 4.11.

\noindent 

Table 4.28: Elizabeth's Reply Table Entry

\begin{tabular}{|p{0.4in}|p{0.5in}|p{0.3in}|p{0.5in}|p{0.3in}|} \hline 
${Aid}_{old}$ & ${Aapt}_{old}$ & ${ID}_{nxt}$ & ${Aapt}_{new}$ & EQL \\ \hline 
E & ${capt}^1_E$ & B & ${aapt}^{E\left(1\right)}_E$ & 1 \\ \hline 
\end{tabular}


Figure 4.11: Elizabeth Forwards A Reply

\noindent If Bob receives the reply message successfully, he checks his reply table as shown in Table 4.21. He finds an entry whose ${Aid}_{old}$ is equal to Elizabeth and ${Aapt}_{old}$ is equal to ${aapt}^{E\left(1\right)}_E$, as shown in Table 4.29. In the same way as Elizabeth, Bob forwards reply message to Charlie, as shown in Figure 4.12.

Table 4.29: Bob's Reply Table Entry

\begin{tabular}{|p{0.4in}|p{0.5in}|p{0.3in}|p{0.5in}|p{0.3in}|} \hline 
\multicolumn{5}{|p{1in}|}{Bob} \\ \hline 
${Aid}_{old}$ & ${Aapt}_{old}$ & ${ID}_{nxt}$ & ${Aapt}_{old}$ & EQL \\ \hline 
E & ${aapt}^{E\left(1\right)}_E$ & C & ${aapt}^{E\left(1\right)}_B$ & 2 \\ \hline 
\end{tabular}


Figure 4.12: Bob Forwards A Reply

\noindent When the Charlie receives the reply message from Bob, Charlie learns that he is the last agent based on his reply table as shown in Table 4.25 and Table 4.30, because the EQL is equal to 3 and the ${ID}_{nxt}$ is void.

\noindent 

Table 4.30: Charlie's Reply Table Entry

\begin{tabular}{|p{0.4in}|p{0.5in}|p{0.3in}|p{0.5in}|p{0.3in}|} \hline 
\multicolumn{5}{|p{1in}|}{Charlie} \\ \hline 
${Aid}_{old}$ & ${Aapt}_{old}$ & ${ID}_{nxt}$ & ${Aapt}_{new}$ & EQL \\ \hline 
B & ${aapt}^{E\left(1\right)}_B$ & VOID & ${aapt}^{E\left(1\right)}_C$ & 3 \\ \hline 
\end{tabular}



\noindent To forward to the unknown original requester (i.e. David), Charlie generates a pseudonym ${psd}^{E\left(1\right)}_c=\mathrm{pseudo}\left(Charlie,{aapt}^{\mathrm{E}\left(1\right)}_c\right)$ using his own identity and ${Aapt}_{new}$. We should notice that the pseudonym is exactly the temporary identity of David. Then David modifies the reply message and forwards it, as shown in Figure 4.13.

Figure 4.13: Charlie Forwards A Reply

\noindent When a user who carries ${Reply}^{E\left(1\right)}_C$ encounters David, the user forwards the reply to him, so that David gets his reply.

